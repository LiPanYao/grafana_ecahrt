{"version":3,"sources":["../src/graph_ctrl.js"],"names":["MetricsPanelCtrl","moment","_","TimeSeries","$","panelDefaults","mode","dataPrecise","DT","url","EchartsCtrl","$scope","$injector","$rootScope","defaults","panel","DTOption","name","value","events","on","onInitEditMode","bind","onDataReceived","addEditorTab","dataList","data","fixed","render","length","max","i","datapoints","Fdata","num","fixedData","time","getTimesByLongTime","myDate","Date","times","fullTime","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","number","toFixed","console","info","Va","scope","elem","attrs","ctrl","pageCount","getTableHeight","panelHeight","height","rootElem","find","css","templateUrl"],"mappings":"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","file":"graph_ctrl.js","sourcesContent":["import {\n\tMetricsPanelCtrl\n} from 'app/plugins/sdk';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport TimeSeries from 'app/core/time_series';\nimport './css/clock-panel.css!';\nimport $ from 'jquery';\n\nvar panelDefaults = {\n\tmode: 'alarmInfo',\n\tdataPrecise: 2,\n\tDT: 'hidden',\n\turl: '', //默认显示模式\n};\n\nexport class EchartsCtrl extends MetricsPanelCtrl {\n\tconstructor($scope, $injector, $rootScope) {\n\t\tsuper($scope, $injector);\n\t\tthis.$rootScope = $rootScope;\n\n\t\t_.defaults(this.panel, panelDefaults); //将panelDefaults属性附加到this.panel上\n\t\tvar DTOption = [{\n\t\t\t\tname: '显示时间',\n\t\t\t\tvalue: \"show\"\n\t\t\t}, {\n\t\t\t\tname: '隐藏时间',\n\t\t\t\tvalue: \"hidden\"\n\t\t\t},\n\n\t\t];\n\t\tthis.panel.DTOption = DTOption;\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\n\t}\n\n\tonInitEditMode() {\n\t\tthis.addEditorTab('Options', 'public/app/plugins/panel/grafana-table-graphs/editor.html', 2);\n\t}\n\tonDataReceived(dataList) {\n\t\tthis.data = dataList;\n\t\tthis.fixed();\n\t\tthis.render();\n\t}\n\tfixed() {\n\t\tif (this.data.length == 0) {\n\t\t\treturn\n\t\t} else\n\t\tif (this.data[0].value == null && this.data[0].max == null) {\n\n\t\t\tfor (var i = 0; i < this.data.length; i++) {\n\t\t\t\tif (this.data[i].datapoints.length == 0) {\n\t\t\t\t\tthis.data[i].Fdata = \"-\";\n\t\t\t\t\tcontinue\n\t\t\t\t} else {\n\t\t\t\t\tvar num = this.data[i].datapoints[0][0];\n\t\t\t\t\tvar fixedData = num.toFixed(this.panel.dataPrecise);\n\t\t\t\t\tif (fixedData == -9999) {\n\t\t\t\t\t\tfixedData = \"-\";\n\t\t\t\t\t}\n\t\t\t\t\tthis.data[i].Fdata = fixedData;\n\t\t\t\t\tvar time = this.data[i].datapoints[0][1];\n\n\t\t\t\t\tfunction getTimesByLongTime(time) {\n\t\t\t\t\t\tvar myDate = new Date(time);\n\t\t\t\t\t\tvar times = fullTime(myDate.getFullYear());\n\t\t\t\t\t\ttimes += \"-\" + fullTime(myDate.getMonth());\n\t\t\t\t\t\ttimes += \"-\" + fullTime(myDate.getDate());\n\t\t\t\t\t\ttimes += \" \" + fullTime(myDate.getHours());\n\t\t\t\t\t\ttimes += \":\" + fullTime(myDate.getMinutes());\n\t\t\t\t\t\ttimes += \":\" + fullTime(myDate.getSeconds());\n\t\t\t\t\t\treturn times;\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction fullTime(number) {\n\t\t\t\t\t\tif (number < 10) {\n\t\t\t\t\t\t\treturn \"0\" + number;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.data[i].times = getTimesByLongTime(time);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.panel.mode = \"commonData\";\n\t\t\tconsole.info(\"fixed over\")\n\t\t} else\n\t\tif (this.data[0].value != null && this.data[0].max == null) {\n\t\t\tfor (var i = 0; i < this.data.length; i++) {\n\t\t\t\tvar num = this.data[i].value;\n\t\t\t\tvar fixedData = num.toFixed(this.data[i].dataPrecise);\n\t\t\t\tif (fixedData == -9999) {\n\t\t\t\t\tfixedData = \"-\";\n\t\t\t\t}\n\t\t\t\tthis.data[i].Va = fixedData;\n\t\t\t}\n\n\t\t\tthis.panel.mode = \"relativeInfo\";\n\t\t} else {\n\t\t\tthis.panel.mode = \"alarmInfo\";\n\t\t}\n\n\t}\n\tonRender() {\n\t\tconsole.info(\"action onRender\");\n\t}\n\n\tlink(scope, elem, attrs, ctrl) {\n\t\tvar pageCount = 0;\n\t\t//table高度\n\t\tfunction getTableHeight() {\n\t\t\tvar panelHeight = ctrl.height;\n\t\t\tif (pageCount > 1) {\n\t\t\t\tpanelHeight -= 26;\n\t\t\t}\n\t\t\treturn (panelHeight - 31) + 'px';\n\t\t}\n\n\t\tctrl.events.on('render', function() {\n\t\t\tctrl.fixed();\n\t\t\tvar rootElem = elem.find('.table-panel-scroll'); //表格需要处理高度\n\t\t\tpageCount = ctrl.data.length;\n\t\t\t\trootElem.css({\n\t\t\t\t\t'max-height': getTableHeight()\n\t\t\t\t})\n\t\t});\n\t}\n}\n\nEchartsCtrl.templateUrl = 'module.html';"]}